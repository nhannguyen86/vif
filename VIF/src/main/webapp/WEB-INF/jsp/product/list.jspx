<div xmlns:spring="http://www.springframework.org/tags"
	xmlns:util="urn:jsptagdir:/WEB-INF/tags/util"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
	xmlns:jsp="http://java.sun.com/JSP/Page" version="2.0"
	xmlns:form="http://www.springframework.org/tags/form" class="Provinces"
	xmlns:sec="http://www.springframework.org/security/tags"
	escapeXML="true">
	<jsp:directive.page import="java.util.Arrays" />
	<jsp:directive.page import="java.util.ArrayList" />
	<jsp:directive.page import="java.util.List" />
	<jsp:output omit-xml-declaration="yes" />

	<spring:url var="imagesFolder" value="/images" />
	<spring:url var="ajaxURL" value="/ajax" />
	<spring:url var="scriptsFolder" value="/scripts" />
	<spring:url var="productViewURL" value="/product/view" />
	<spring:url var="productAddURL" value="/product/add/" />
	<spring:url var="imagesFolder" value="/images" />

	<![CDATA[
<script type="text/javascript" src="${scriptsFolder}/product.js"></script>
<script type="text/javascript">
	var contextPath = "${pageContext.request.contextPath}";
	function exportReport(type){
		if ($('#frm_startDate').val() == ""
			|| $('#frm_endDate').val() == "") {
			alert("Chá»n ngÃ y xuáº¥t bÃ¡o cÃ¡o");
			return;
		}
		var action = document.getElementById('productListForm').action;
		document.getElementById('productListForm').action = contextPath +"/report/transvaslist?type=" + type;
		document.getElementById('productListForm').submit();
		document.getElementById('productListForm').action = action;
	}

	function viewResults() {
		$('#productListForm').submit();
	}
</script>
]]>

	<div id="inner-content">
		<span class="bor-left"><img src="${imagesFolder}/dummy.gif"
			alt="" /></span>
		<div class="content-title">
			<h2>
				<span>Danh Sách Hàng Hóa</span>
			</h2>
		</div>
		<div id="content">
			<form:form method="POST" commandName="productListForm" id="productListForm">
				<table width="100%" border="0" cellspacing="5px" cellpadding="0"
					class="table-1">
					<tr>
						<td>
							<c:choose>
								<c:when test="${companyLogin!=null}">
									<input type="hidden" name="company" value="${companyLogin}"/>
								</c:when>
								<c:otherwise>
									<div style="padding-left: 10px; display: inline;">
										<form:select style="width:140px;" path="company" onchange="selectCompany(this);">
											<form:options items="${companies}" itemValue="id"
												itemLabel="ten" />
										</form:select>
									</div>
								</c:otherwise>
							</c:choose>
							<div style="padding-left: 10px; display: inline;">
								<form:select path="goodsCatId" style="width:140px">
									<form:options items="${goodsCatList}" itemValue="id"
										itemLabel="name" />
								</form:select>
							</div>
							
							<div style="padding-left: 10px; display: inline;">
								<form:select path="status" style="width:140px">
									<form:options items="${statusList}" itemValue="id"
										itemLabel="name" />
								</form:select>
							</div>
							<div style="padding-left: 10px; display: inline;">
								<label>
									Tìm theo tên/ mã:
								</label>
								<form:input path="searchText" cssStyle="width: 160px" />
							</div>
						</td>
						<td>

							
						</td>
					</tr>
					<tr>
						
						<td></td>
						<td><a href="javascript:;" onclick="viewResults()"
							class="btn-1" title="Xem kết quả"><span><span>&#160;&#160;Xem
										kết quả&#160;&#160;</span></span></a>
							<sec:authorize ifAnyGranted="ROLE_SMD_ADMIN,ROLE_COMPANY_ADMIN">			
							<a href="${productAddURL}" class="btn-1"
													title="Thêm mới"><span><span>Thêm mới</span></span></a>
							</sec:authorize>													
						</td>
					</tr>
					
					<tr>
						<td colspan="4" style="text-align: left;"><form:errors
								path="filter_message"></form:errors></td>
					</tr>
					<tr>
						<td colspan="4"><util:pagination maxPages="${maxPages}"
								page="${page}" size="${size}" id="productTopPagination"
								formSubmit="productListForm" submitMethod="POST" /></td>
					</tr>
					<tr>
						<td colspan="4">
							<table width="99%" border="0" cellspacing="0" cellpadding="0"
								class="table-2">
								<thead>
									<tr>
										<td width="4%">STT</td>
										<td width="14%">Mã HH</td>
										<td>Tên hàng hóa</td>
										<td width="14%">Loại</td>
										<td width="8%">Trạng thái</td>
										<td width="8%">Giá</td>
										<td width="10%">Hành động</td>
									</tr>
								</thead>
								<tbody>
									<c:choose>
										<c:when test="${not empty productList}">
											<c:forEach items="${productList}" var="item" varStatus="status">
												<tr>
													<td align="center">${(page-1)*size+status.count}</td>
													<td>
														<a href="${productViewURL}/${item.id}" title="Xem">
															${item.goodsCode}
														</a>
													</td>
													<td>
														<a href="${productViewURL}/${item.id}" title="Xem">
															${item.goodsName}
														</a>
													</td>
													<td>${item.goodsCat.catName}</td>
													<td>${item.statusString}</td>
													<td align="right"><fmt:formatNumber type="number" 
            											pattern="###,###" value="${item.price}" /></td>
            										<td align="center">
														<a href="${productViewURL}/${item.id}" class="redTxt" title="Xem">
															Xem
														</a>
														<sec:authorize ifAnyGranted="ROLE_SMD_ADMIN,ROLE_COMPANY_ADMIN">
															<c:if test="${item.status != deactive}">
																&#160;|&#160;
																<a href="javascript:;" onclick="javascript:deleteProduct(${item.id})" class="redTxt" title="Xóa">
																	Xóa
																</a>
															</c:if>
														</sec:authorize>
													</td>
												</tr>
											</c:forEach>
										</c:when>
										<c:otherwise>
											<tr>
												<td colspan="7" align="center">Không có dữ liệu.</td>
											</tr>
										</c:otherwise>
									</c:choose>
								</tbody>
							</table>
						</td>
					</tr>
					<tr>
						<td colspan="4"><util:pagination maxPages="${maxPages}"
								page="${page}" size="${size}" id="productBottomPagination"
								formSubmit="productListForm" submitMethod="POST" /></td>
					</tr>
					<tr>
						<td colspan="4">
							<!--<a href="javascript:exportReport('xls');"
							class="btn-1" title="Export XLS"><span><span>Xuất
										ra Excel</span></span></a> &#160;&#160;&#160;
						--></td>
					</tr>
				</table>
			</form:form>
		</div>
	</div>
</div>